<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IPv6Gen.net | Vanity Address Forge</title>
    <meta name="description" content="Professional Vanity IPv6 Address Generator. Supports Hexspeak, Creative mappings, and RFC-compliant configuration snippets.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>v6</text></svg>">
    <meta name="theme-color" content="#0d1117">

    <style>
        :root {
            --bg: #0d1117; --card-bg: #161b22;
            --text: #e6edf3; --sub-text: #8b949e;
            --primary: #238636; --primary-txt: #ffffff; 
            --accent: #2f81f7; --err: #f85149; --warn: #d29922;
            --border: #30363d;
            --font: 'JetBrains Mono', 'Fira Code', monospace;
        }
        
        [data-theme="light"] {
            --bg: #ffffff; --card-bg: #f6f8fa;
            --text: #1F2328; --sub-text: #656d76;
            --primary: #1f883d; --primary-txt: #ffffff;
            --accent: #0969da; --err: #cf222e; --warn: #9a6700;
            --border: #d0d7de;
        }

        * { box-sizing: border-box; transition: background-color 0.2s, border-color 0.2s; touch-action: manipulation; }
        body { background: var(--bg); color: var(--text); font-family: var(--font); margin: 0; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }
        
        .container { max-width: 850px; width: 100%; display: grid; gap: 1.5rem; }
        
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            border-bottom: 1px solid var(--border); padding-bottom: 1.5rem; margin-bottom: 1rem; 
        }
        h1 { color: var(--primary); margin: 0; font-size: 1.8rem; letter-spacing: 1px; }
        .icon-btn { 
            background: none; border: 1px solid var(--border); color: var(--sub-text); 
            width: 44px; height: 44px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; 
        }
        .icon-btn:hover { color: var(--accent); border-color: var(--accent); }

        .panel { background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; padding: 1.5rem; }
        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        @media (max-width: 600px) { .controls { grid-template-columns: 1fr; gap: 1rem; } }

        .input-group { position: relative; margin-top: 5px; }
        label { font-size: 0.8rem; color: var(--sub-text); font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        
        input[type="text"] {
            background: var(--bg); border: 1px solid var(--border); color: var(--text);
            font-family: var(--font); font-size: 1.1rem; padding: 12px; 
            border-radius: 6px; width: 100%; outline: none; height: 48px;
            margin-top: 0.5rem;
        }
        input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1); }

        .input-row { display: flex; gap: 10px; align-items: center; }

        .chips { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
        .chip { 
            background: var(--bg); border: 1px solid var(--border); color: var(--sub-text); 
            font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; cursor: pointer;
        }
        .chip:hover { border-color: var(--accent); color: var(--accent); }

        .card { 
            cursor: pointer; position: relative; transition: transform 0.2s; 
            border: 1px solid var(--border); background: var(--card-bg); border-radius: 8px; padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .card:hover { border-color: var(--accent); transform: translateY(-2px); }
        .card.disabled { opacity: 0.6; pointer-events: none; border-color: var(--err); }
        
        .card-head { font-size: 0.8rem; color: var(--sub-text); margin-bottom: 0.8rem; display: flex; justify-content: space-between; text-transform: uppercase; letter-spacing: 1px; }
        .addr { font-size: 1.4rem; word-break: break-all; font-weight: 500; line-height: 1.4; }
        
        .pfx-part { opacity: 0.5; margin-right: 2px; }
        .val { color: var(--primary); font-weight: bold; }
        .creative { color: var(--accent); text-decoration: underline dotted; }
        .err { color: var(--err); text-decoration: underline wavy; }
        .sep { color: var(--sub-text); margin: 0 2px; opacity: 0.5; }

        .tools { display: flex; gap: 10px; margin-top: 15px; }
        .btn-tool { 
            background: var(--bg); border: 1px solid var(--border); color: var(--text); 
            padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.75rem; 
        }
        .btn-tool:hover { border-color: var(--accent); color: var(--accent); }
        .btn-tool:disabled { opacity: 0.5; cursor: not-allowed; border-color: var(--border); color: var(--sub-text); }

        .switch-group { display: flex; gap: 15px; align-items: center; }
        .switch { display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.75rem; color: var(--sub-text); }
        .switch input { display: none; }
        .slider { width: 30px; height: 16px; background: var(--border); border-radius: 20px; position: relative; transition: 0.3s; }
        .slider::before { content: ""; position: absolute; height: 12px; width: 12px; left: 2px; bottom: 2px; background: var(--bg); border-radius: 50%; transition: 0.3s; }
        input:checked + .slider { background: var(--primary); }
        input:checked + .slider::before { transform: translateX(14px); }

        #toast { 
            visibility: hidden; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); 
            background: var(--primary); color: var(--primary-txt); padding: 12px 24px; 
            border-radius: 8px; z-index: 200; font-weight: bold; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        #toast.show { visibility: visible; animation: fadein 0.3s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from { bottom: 0; opacity: 0; } to { bottom: 30px; opacity: 1; } }
        @keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
        
        .ula-helper { font-size: 0.75rem; color: var(--warn); margin-top: 8px; display: none; align-items: center; gap: 8px; }
        .ula-btn { background: none; border: 1px solid var(--warn); color: var(--warn); border-radius: 4px; padding: 2px 8px; cursor: pointer; }

        /* Modal */
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 300; align-items: center; justify-content: center; }
        .modal-content { background: var(--card-bg); padding: 2rem; border-radius: 8px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid var(--border); color: var(--text); }
        .modal-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .close-btn { background: none; border: none; font-size: 1.5rem; color: var(--sub-text); cursor: pointer; }
        .map-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; font-size: 0.9rem; }
        .map-item { background: var(--bg); padding: 5px; border-radius: 4px; text-align: center; border: 1px solid var(--border); }
        .map-k { font-weight: bold; color: var(--accent); }
        .map-v { color: var(--primary); }

    </style>
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ipv6gen.net/">
    <meta property="og:title" content="IPv6Gen.net | Vanity IPv6 Address Generator">
    <meta property="og:description" content="Generate valid, vanity IPv6 addresses using Hexspeak and Leetspeak. The ultimate tool for network engineers and sysadmins.">
    <meta property="og:image" content="https://ipv6gen.net/assets/ipv6card.png">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="IPv6Gen.net | Vanity IPv6 Address Generator">
    <meta name="twitter:description" content="Forge custom IPv6 addresses instantly. Zero ads, privacy-focused.">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "IPv6Gen",
      "url": "https://ipv6gen.net",
      "description": "A client-side tool to generate vanity IPv6 addresses using hexspeak mappings.",
      "applicationCategory": "NetworkTool",
      "operatingSystem": "Any"
    }
    </script>
    <link rel="canonical" href="https://ipv6gen.net/">
    <script defer src="https://umami.ipv6gen.net/script.js" data-website-id="f8310bf2-dbab-4299-bbea-23abae5eb196"></script>
</head>
<body>
    
    <div class="container">
        <header>
            <h1>IPv6Gen.net</h1>
            <button class="icon-btn" onclick="toggleTheme()" id="themeBtn">‚òÄ</button>
        </header>

        <div class="panel controls">
            <div>
                <label>Prefix / Subnet</label>
                <div class="input-row">
                    <input type="text" id="prefix" value="3fff" spellcheck="false" placeholder="3fff">
                    <select id="subnetSelect" onchange="debouncedRender()" style="background:var(--bg); color:var(--text); border:1px solid var(--border); padding:0 10px; height:48px; border-radius:6px; margin-top:0.5rem; outline:none; font-family:var(--font);">
                        <option value="64">/64</option>
                        <option value="48">/48</option>
                        <option value="56">/56</option>
                    </select>
                </div>
                <div class="ula-helper" id="ulaHelper">
                    ‚ö†Ô∏è Randomize ULA Global ID? <button class="ula-btn" onclick="randomizeULA()">Randomize</button>
                </div>
                <div class="chips">
                    <span class="chip" onclick="setPfx('fe80')">Link-Local</span>
                    <span class="chip" onclick="setPfx('fd00')">ULA (Priv)</span>
                    <span class="chip" onclick="setPfx('2001:db8')">Old Docs</span>
                    <span class="chip" onclick="setPfx('3fff')">RFC 9637</span>
                </div>
            </div>
            <div>
                <label>
                    Vanity Phrase
                    <div style="display:flex; gap:10px; align-items:center;">
                        <span class="chip" style="padding:0 6px; height:18px; line-height:16px; font-size:0.7rem;" onclick="showMappings()">?</span>
                    </div>
                </label>
                <div class="input-row">
                    <input type="text" id="input" placeholder="dead beef cafe" maxlength="32" autofocus spellcheck="false" style="flex-grow:1">
                    <button class="icon-btn" onclick="randomize()" title="I'm Feeling Lucky" style="height:48px; width:48px; border-radius:6px; margin-top:0.5rem">üé≤</button>
                </div>
                <div class="switch-group" style="margin-top:10px; justify-content:flex-end;">
                     <label class="switch" title="Separate words with colons">
                        <input type="checkbox" id="sepMode" onchange="toggleOpt('sepMode'); debouncedRender()">
                        <span class="slider"></span> Sep Words
                    </label>
                    <label class="switch" title="Fill empty groups with zeros">
                        <input type="checkbox" id="expandedMode" onchange="toggleOpt('expandedMode'); debouncedRender()">
                        <span class="slider"></span> Expanded
                    </label>
                </div>
                <div class="chips">
                    <span class="chip" onclick="setInput('coffee')">coffee</span>
                    <span class="chip" onclick="setInput('bad code')">bad code</span>
                    <span class="chip" onclick="setInput('face feed')">face feed</span>
                </div>
            </div>
        </div>

        <div id="results"></div>

        <footer style="text-align:center; font-size:0.75rem; color:var(--sub-text); margin-top: 2rem;">&copy; <span id="year">2026</span> IPv6Gen.net</footer>
    </div>

    <div id="toast">Copied!</div>

    <!-- Mappings Modal -->
    <div id="modal" onclick="if(event.target===this)this.style.display='none'">
        <div class="modal-content">
            <div class="modal-head">
                <strong>Character Mappings</strong>
                <button class="close-btn" onclick="document.getElementById('modal').style.display='none'">&times;</button>
            </div>
            <div style="font-size:0.8rem; color:var(--sub-text); margin-bottom:10px;">Standard Hexspeak</div>
            <div class="map-grid" id="leetGrid"></div>
            <div style="font-size:0.8rem; color:var(--sub-text); margin:15px 0 10px;">Creative Mappings</div>
            <div class="map-grid" id="creativeGrid"></div>
        </div>
    </div>

<script>
    const LOGIC = {
        leet: { 'o':'0', 'i':'1', 'l':'1', 'z':'2', 'r':'2', 'e':'3', 'a':'4', 's':'5', 'g':'6', 'b':'8', 't':'7', 'q':'9' },
        creative: { 
            'h':'11', 'j':'1', 'k':'c', 'm':'aa', 'n':'17', 'p':'9', 'u':'c', 'v':'c', 'w':'33', 'x':'8', 'y':'7',
            'd':'d', 'i':'1', 'z':'2', 'f':'f' 
        }
    };
    
    const HEX_DB = {
        verbs: [ "hack", "ping", "sudo", "init", "exit", "kill", "load", "save", "scan", "test", "boot", "wipe", "read", "bind", "free", "lock", "make", "find", "grep", "echo", "tail", "head", "less", "curl", "seek", "hide", "call", "cook", "drop", "fsck", "nice", "link", "feed", "dead" ],
        adjectives: [ "bad", "dead", "fast", "last", "best", "cool", "real", "idle", "flat", "safe", "lost", "gold", "bold", "cold", "rare", "soft", "free", "epic", "evil", "leet", "raw", "red", "blue", "dark", "hard", "deep", "null", "full", "void", "zero", "beta", "tiny", "huge", "loud", "pure", "sour", "1337", "d0pe", "n00b", "sick", "odd", "f47", "l0ud", "d3af", "b0ld", "new", "top", "hot", "dry", "wet", "cafe" ],
        tech: [ "blob", "byte", "calc", "cell", "chip", "clip", "code", "core", "data", "disk", "docs", "file", "flag", "font", "grid", "hash", "heap", "host", "icon", "ipv6", "java", "keys", "link", "list", "load", "lock", "loop", "mail", "mode", "node", "note", "pass", "path", "perl", "pipe", "port", "post", "root", "ruby", "rust", "sass", "site", "slot", "soft", "sort", "sql", "ssl", "stat", "sudo", "sync", "tabs", "tags", "task", "temp", "term", "text", "tool", "tree", "type", "unit", "user", "vars", "view", "void", "wifi", "wiki", "word", "xml", "yaml", "zone", "bios", "cmos", "sata", "scsi", "nvme", "pcie", "gpio", "dhcp", "dns", "http", "icmp", "imap", "ldap", "pop3", "smtp", "snmp", "ssh", "bash", "calc", "log" ],
        infra: [ "nas", "san", "raid", "zfs", "ceph", "prox", "esxi", "lxc", "pod", "kube", "helm", "ans", "chef", "salt", "git", "ci", "cd", "aws", "gcp", "az", "vps", "vm", "lan", "wan", "vpn", "nat", "vlan", "bgp", "ospf", "tor", "p2p", "seed", "peer", "box", "rack", "ups", "pdu", "plex" ],
        geek: [ "jedi", "sith", "yoda", "luke", "leia", "solo", "maul", "bane", "trek", "kirk", "borg", "data", "worf", "dune", "paul", "leto", "gola", "sand", "neo", "zion", "tank", "tron", "clu", "iso", "grid", "disk", "toad", "link", "doom", "hal", "cake", "cube", "loot", "raid", "boss", "xp", "lvl", "gg", "afk", "brb", "lol", "pwn", "frag", "lag", "fps", "rpg", "mana", "buff", "nerf", "tank", "dps", "heal", "mob", "agro", "wipe", "rez", "npc", "deck", "ice", "case", "nes", "snes" ],
        startup: [ "seed", "ipo", "saas", "roi", "lean", "mvp", "demo", "deck", "exit", "vest", "burn", "rate", "cap", "term", "deal", "flow", "beta", "live", "ship", "push" ],
        legends: [ "dead beef", "bad cafe", "feed face", "bad c0de", "c001 d00d", "face b00c", "cal1 abba", "ac dc", "1 feel 1ll", "5ea 5he11", "b0rn 2 c0de", "n0 1dea", "beef stew", "bad f00d", "fu11 s7ack", "sud0 bash", "g17 push", "sys admin", "r007 user", "n00b d0wn", "dead 10ck", "b17 r07", "s0ft ware", "hard ware", "ma1 ware", "spy ware", "c15c0 d06 f00d" ]
    };

    const ui = { 
        pfx: document.getElementById('prefix'), inp: document.getElementById('input'), 
        res: document.getElementById('results'), themeBtn: document.getElementById('themeBtn'),
        expanded: document.getElementById('expandedMode'), ulaHelper: document.getElementById('ulaHelper'),
        sepMode: document.getElementById('sepMode'), subnet: document.getElementById('subnetSelect')
    };

    let theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');

    const escape = s => s ? s.toString().replace(/[&<>"']/g, "") : "";
    const chunk = w => w.match(/.{1,4}/g)?.join(':') || w;

    // Load Prefs
    if(localStorage.getItem('sepMode') === 'true') ui.sepMode.checked = true;
    if(localStorage.getItem('expandedMode') === 'true') ui.expanded.checked = true;

    function toggleOpt(id) {
        const el = document.getElementById(id);
        localStorage.setItem(id, el.checked);
    }

    // Transform Logic: Supports both stream and word-separated modes
    function transform(text, creative) {
        const words = text.split(/\s+/).filter(w => w.length > 0);
        let rawTotal = "";
        let htmlTotal = "";
        let valid = true;
        let globalHexCount = 0;

        words.forEach((word, wIdx) => {
            let wordRaw = "";
            let wordHtml = "";
            
            for (let char of word.toLowerCase()) {
                let mapped = null, type = 'val';
                
                if (/[0-9a-f]/.test(char)) mapped = char;
                else if (LOGIC.leet[char] !== undefined) mapped = LOGIC.leet[char];
                else if (creative && LOGIC.creative[char] !== undefined) { 
                    mapped = LOGIC.creative[char]; 
                    type = 'creative'; 
                }
                
                if (mapped !== null) {
                    for (let mChar of mapped) {
                        wordRaw += mChar;
                        // Chunking logic for HTML span placement
                        // If sepMode is OFF, we chunk strictly every 4 chars globally
                        // If sepMode is ON, we chunk inside the word, and force break at word end
                        
                        let isBoundary = false;
                        if (!ui.sepMode.checked) {
                            if (globalHexCount > 0 && globalHexCount % 4 === 0) isBoundary = true;
                        } else {
                            // Word-local chunking? Usually we just let the word flow, but if word > 4 chars, we might want to split?
                            // e.g. "coffee" -> c0ff:ee
                            // Yes, standard chunking applies *within* the word if separated.
                            if (wordRaw.length > 1 && (wordRaw.length - 1) % 4 === 0) isBoundary = true;
                        }

                        if (isBoundary) {
                            wordHtml += '<span class="sep">:</span>';
                            if(!ui.sepMode.checked) rawTotal += ":"; // Sync raw with visual
                        }

                        wordHtml += `<span class="${type}">${escape(mChar)}</span>`;
                        globalHexCount++;
                    }
                } else {
                    wordRaw += "0";
                    wordHtml += `<span class="err" title="Unmapped">${escape(char)}</span>`;
                    valid = false;
                    globalHexCount++;
                }
            }
            
            // Append word result
            rawTotal += wordRaw;
            htmlTotal += wordHtml;

            // Handle Word Separation
            if (ui.sepMode.checked && wIdx < words.length - 1) {
                rawTotal += ":";
                htmlTotal += '<span class="sep" style="opacity:1; color:var(--accent)">:</span>';
                globalHexCount = 0; // Reset counter for next word alignment
            }
        });
        
        return { html: htmlTotal, raw: rawTotal, valid: valid };
    }

    // --- Robust Canonicalizer ---
    function canonicalizeIPv6(addr) {
        try {
            // 1. Normalize
            let clean = addr.toLowerCase().replace(/[^0-9a-f:]/g, '');
            
            // 2. Expand ::
            if (clean.includes('::')) {
                const parts = clean.split('::');
                const left = parts[0].split(':').filter(Boolean);
                const right = parts[1].split(':').filter(Boolean);
                const missing = 8 - (left.length + right.length);
                if (missing > 0) {
                    const zeros = Array(missing).fill('0');
                    clean = [...left, ...zeros, ...right].join(':');
                } else {
                    clean = [...left, ...right].join(':');
                }
            }
            
            // 3. Clean hextets (remove leading zeros)
            let hextets = clean.split(':').map(h => h.replace(/^0+/, '') || '0');
            
            // 4. Validate Length
            if (hextets.length !== 8) throw "Invalid Length";

            // 5. Find Longest Zero Run
            let bestStart = -1, bestLen = 0;
            let curStart = -1, curLen = 0;
            
            for(let i=0; i<8; i++) {
                if(hextets[i] === '0') {
                    if(curStart === -1) curStart = i;
                    curLen++;
                } else {
                    if(curLen > bestLen) { bestLen = curLen; bestStart = curStart; }
                    curStart = -1; curLen = 0;
                }
            }
            if(curLen > bestLen) { bestLen = curLen; bestStart = curStart; }
            
            // 6. Compress
            if (bestLen > 1) {
                hextets.splice(bestStart, bestLen, '');
                if (bestStart === 0) hextets.unshift(''); // Handle ::start
                if (bestStart + bestLen === 8) hextets.push(''); // Handle end::
            }
            
            return hextets.join(':').replace(/^:|:$/g, '::').replace(/:{3,}/g, '::');
        } catch (e) {
            console.error(e);
            return addr; // Fallback to raw if logic fails
        }
    }

    function checkULA() {
        const pfx = ui.pfx.value.toLowerCase().replace(/[^0-9a-f:]/g, '');
        if (pfx.startsWith('fd')) ui.ulaHelper.style.display = 'flex';
        else ui.ulaHelper.style.display = 'none';
    }
    
    window.randomizeULA = () => {
        const rnd = new Uint8Array(5);
        window.crypto.getRandomValues(rnd);
        let hex = 'fd';
        for(let b of rnd) hex += b.toString(16).padStart(2,'0');
        ui.pfx.value = hex.match(/.{1,4}/g).join(':');
        debouncedRender();
    };

    function render() {
        const txt = ui.inp.value;
        let pfxRaw = ui.pfx.value.trim();
        let pfx = pfxRaw.replace(/[^0-9a-fA-F:]/g, '').replace(/:+$/, '') || '3fff';
        
        checkULA();

        const pfxParts = pfx.split(':').filter(Boolean);
        const pfxCount = pfxParts.length;
        const pfxValid = pfxParts.every(p => p.length <= 4);

        if (!pfxValid) {
            ui.res.innerHTML = `<div style="text-align:center; padding:2rem; color:var(--err);">Invalid Prefix</div>`;
            return;
        }

        const variants = [];

        if(txt) {
            const strict = transform(txt, false);
            variants.push({ type:'Strict Hexspeak', html: strict.html, raw: strict.raw, valid: strict.valid });

            const creative = transform(txt, true);
            if(creative.raw !== strict.raw || (!strict.valid && creative.valid)) {
                 variants.push({ type:'Creative Mappings', html: creative.html, raw: creative.raw, valid: creative.valid });
            }

            // Fixed ASCII Rendering to match style
            const toHexRaw = (str) => str.split('').map(c => c.charCodeAt(0).toString(16)).join('');
            const asciiRaw = toHexRaw(txt);
            let asciiDisp = "";
            let asciiFmt = "";
            
            for(let i=0; i<asciiRaw.length; i++) {
                if(i>0 && i%4===0) { asciiDisp += '<span class="sep">:</span>'; asciiFmt += ":"; }
                asciiDisp += `<span class="val">${asciiRaw[i]}</span>`;
                asciiFmt += asciiRaw[i];
            }
            variants.push({ type:'ASCII Bytes', html: asciiDisp, raw: asciiFmt, valid: true });
        }

        ui.res.innerHTML = variants.map(v => {
            const sfxParts = v.raw.split(':').filter(Boolean);
            const sfxCount = sfxParts.length;
            const totalCount = pfxCount + sfxCount;
            
            let joiner = "::";
            let validLen = true;
            let displayPfx = escape(pfx);
            let errorMsg = "";

            if (totalCount > 8) {
                validLen = false;
                joiner = ":"; 
                errorMsg = `<div style="color:var(--err); font-size:0.75rem;">‚ö†Ô∏è Overflow: ${totalCount}/8 hextets.</div>`;
            } else if (totalCount === 8) {
                joiner = ":";
            } else {
                if (ui.expanded.checked) {
                    const missing = 8 - totalCount;
                    const zeros = Array(missing).fill('0').join(':');
                    joiner = `:${zeros}:`;
                }
            }
            
            const fullRaw = `${pfx}${joiner}${v.raw}`;
            const copyVal = (validLen && pfxValid) ? canonicalizeIPv6(fullRaw) : fullRaw;
            
            if (pfx.startsWith('fe80')) errorMsg += `<div style="color:var(--warn); font-size:0.75rem;">‚ö†Ô∏è Link-local needs scope (e.g. %eth0).</div>`;

            return `
            <div class="card ${!validLen ? 'disabled' : ''}" onclick="${validLen ? `copy('${copyVal}')` : ''}">
                <div class="card-head">
                    <span>${v.type}</span>
                    ${!v.valid ? '<span style="color:var(--err)">Invalid Char</span>' : ''}
                    ${!validLen ? '<span style="color:var(--err)">Overflow</span>' : ''}
                </div>
                <div class="addr"><span class="pfx-part">${displayPfx}${joiner}</span>${v.html}</div>
                ${errorMsg}
                <div class="tools">
                    <button class="btn-tool" onclick="event.stopPropagation(); copy('${copyVal}')" ${!validLen ? 'disabled' : ''}>Copy Canonical</button>
                    <button class="btn-tool" onclick="event.stopPropagation(); copyCmd('${copyVal}')" ${!validLen ? 'disabled' : ''}>Linux Cmd</button>
                    <button class="btn-tool" onclick="event.stopPropagation(); copyWin('${copyVal}')" ${!validLen ? 'disabled' : ''}>Win Cmd</button>
                </div>
            </div>`;
        }).join('') || '<div style="text-align:center; padding:2rem; opacity:0.5">Type to forge...</div>';
        
        const params = new URLSearchParams({pfx, txt});
        window.history.replaceState({}, '', `?${params}`);
    }

    window.setPfx = (v) => { ui.pfx.value = v; debouncedRender(); };
    window.setInput = (v) => { ui.inp.value = v; debouncedRender(); };
    
    window.randomize = () => { 
        let attempts = 0;
        let phrase = "";
        const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
        
        while (attempts < 15) {
            const mode = Math.random();
            if (mode < 0.4) phrase = pick(HEX_DB.legends);
            else if (mode < 0.8) phrase = `${pick(HEX_DB.adjectives)} ${Math.random() < 0.5 ? pick(HEX_DB.tech) : pick(HEX_DB.geek)}`;
            else phrase = pick(HEX_DB.verbs);
            
            // Check Hex Length (Approx 32 chars max)
            const raw = transform(phrase, true).raw.replace(/:/g, '');
            if (raw.length <= 32) break;
            attempts++;
        }
        ui.inp.value = phrase; debouncedRender(); 
    };
    
    window.showMappings = () => {
        const renderGrid = (obj, id) => {
            document.getElementById(id).innerHTML = Object.entries(obj).map(([k,v]) => 
                `<div class="map-item"><span class="map-k">${k}</span> &rarr; <span class="map-v">${v}</span></div>`
            ).join('');
        };
        renderGrid(LOGIC.leet, 'leetGrid');
        renderGrid(LOGIC.creative, 'creativeGrid');
        document.getElementById('modal').style.display = 'flex';
    };

    window.copy = (v) => { navigator.clipboard.writeText(v); showToast("Address Copied!"); };
    window.copyCmd = (v) => { navigator.clipboard.writeText(`ip -6 addr add ${v}/${ui.subnet.value} dev eth0`); showToast("Linux Cmd Copied!"); };
    window.copyWin = (v) => { navigator.clipboard.writeText(`netsh interface ipv6 add address "Ethernet" ${v}`); showToast("Windows Cmd Copied!"); };

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg; t.className = "show"; setTimeout(() => t.className = "", 2000);
    }

    window.toggleTheme = () => {
        theme = theme === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', theme);
        ui.themeBtn.innerText = theme === 'dark' ? '‚òÄ' : '‚òæ';
        localStorage.setItem('theme', theme);
    };

    let timeout;
    window.debouncedRender = () => { clearTimeout(timeout); timeout = setTimeout(render, 150); };

    document.documentElement.setAttribute('data-theme', theme);
    ui.themeBtn.innerText = theme === 'dark' ? '‚òÄ' : '‚òæ';
    document.getElementById('year').innerText = new Date().getFullYear();
    
    const params = new URLSearchParams(window.location.search);
    if(params.has('pfx')) ui.pfx.value = params.get('pfx');
    if(params.has('txt')) ui.inp.value = params.get('txt');
    [ui.pfx, ui.inp].forEach(e => e.addEventListener('input', debouncedRender));
    render();
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bfa2464fd22df1a',t:'MTc2ODY5Nzg4Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>